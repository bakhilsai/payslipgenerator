<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payslip Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background: #f5f7fa; }
    header { background: linear-gradient(90deg,#3949ab,#1976d2); color: #fff; padding: 1.5rem 2rem; text-align: center; box-shadow: 0 2px 8px #ddd; }
    main { max-width: 880px; margin: 2rem auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #dde2ee; padding: 2.3rem 2%; }
    .form-group { margin-bottom: 1rem; }
    label { display: block; margin-bottom: 0.3rem; font-weight: 500; }
    input, select { width: 100%; padding: 0.5rem; border: 1px solid #bdbdbd; border-radius: 5px; background: #f6fafd; }
    .row { display: flex; gap: 1.5rem; }
    .row > .form-group { flex: 1; }
    .preview-section { margin-top: 2.7rem; }
    .template-selector { margin-bottom: 1.2rem; }
    .btn { background: #3949ab; color: #fff; border: none; padding: 0.7rem 1.7rem; border-radius: 5px; cursor: pointer; margin-right: 1rem; font-size: 1rem;}
    .btn:disabled { opacity: 0.6; cursor: default; }
    .logo-preview { max-height: 70px; margin: 0.5rem 0; border-radius: 7px; }
    .add-row-btn { background: #009688; color: #fff; border: none; border-radius: 4px; padding: 0.3rem 0.7rem; font-size: 1.1em; margin-left: 0.6rem; cursor:pointer;}
    .remove-row-btn { background: #e91e63; color: #fff; border: none; border-radius: 4px; padding: 0.1rem 0.5rem; margin-left: 0.5rem; cursor:pointer; font-size:1.1em;}
    .table-section { margin-top: 0.7rem; margin-bottom: 1.5rem;}
    .table-section label { margin-bottom: 0.2rem;}
    .custom-table { width: 100%; border-spacing: 0; margin-bottom: 0.2rem;}
    .custom-table th, .custom-table td { padding: 0.3rem 0.5rem; border-bottom: 1px solid #e3e6f3; }
    .custom-table th { background: #f4f7fb; }
    .custom-table input { width: 100%; }
    @media (max-width: 700px) {
      .row { flex-direction: column; }
      main { padding: 1.1rem 2%; }
    }

    /* Payslip templates */
    .payslip-container {
      width: 100%;
      min-width: 0;
      margin-left: 0;
    }
    .payslip { 
      width: 540px;  /* made narrower */
      max-width: 98vw;
      margin: 0;
      border: 1px solid #ebebeb !important;
      border-radius: 10px; 
      background: #fff !important; /* minimal grey/white */
      padding: 1.3rem 1.2rem 1.2rem 1.5rem;
      color: #222; 
      box-shadow: 0 1px 6px #eee !important;
      font-size: 1.08rem;
      text-align: left !important;
      margin-left: 0 !important;
      margin-right: auto !important;
      /* keep all content left-aligned */
    }
    .payslip header { font-size: 1.18rem; font-weight: 700; margin-bottom: 0.7rem; display: flex; align-items: center; justify-content: flex-start; gap: 1rem; padding: 0; }
    .payslip .company-logo { max-height: 48px; border-radius: 7px; margin-left: 0; margin-right: 1rem;}
    .payslip .company-title { font-size: 1.15rem; font-weight: 700; color: #3949ab; margin-right: 1.5rem;}
    .payslip .company-addr { font-size: 0.97em; color: #555; margin-bottom: 0.4em; text-align: left;}
    .payslip table { width: 100%; border-collapse: collapse; margin: 0.1em 0 0.1em 0 !important; }
    .payslip th, .payslip .emp-table th {
      background: #fff !important;
      color: #333;
      font-weight: 500;
      padding: 0.15rem 0.2rem;
      text-align: left !important;
    }
    .payslip .emp-table th, .payslip .emp-table td,
    .payslip table th, .payslip table td {
      text-align: left !important;
      padding: 0.18rem 0.3rem !important;
    }
    .payslip .emp-table th, .payslip .emp-table td {
      width: unset !important;
      font-size: 1em !important;
    }
    .payslip .emp-table {
      width: 100%;
      margin: 0 0 0.8em 0;
      border: none;
      display: flex;
      flex-direction: column;
      gap: 2px;
      align-items: flex-start;
      background: none !important;
    }
    .payslip .emp-table .emp-row {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 1.1em;
      margin-bottom: 2px;
      background: none !important;
      width: 100%;
    }
    .payslip .emp-table .label {
      min-width: 170px;
      font-weight: 500;
      color: #263357;
      text-align: left;
      background: none !important;
    }
    .payslip .emp-table .emp-value {
      color: #212121;
      background: none !important;
    }
    .payslip .summary { font-weight: 600; background: #f7faff;}
    .payslip .summary th, .payslip .summary td { font-weight: 700; }
    .payslip hr { border: none; border-top: 1.5px solid #e3e6f3; margin: 1em 0 1em 0; }

    /* Template 2: Modern Teal (just border color and subtle bg) */
    .template-2 { background: #fcfffd !important; border: 1px solid #b2dfdb !important; }
    .template-2 th { background: #f8fffc !important;}
    .template-2 .summary { background: #ebfef7 !important;}
    /* Template 3: Classic Blue Right Logo */
    .template-3 { background: #fff !important; border: 1.5px solid #cfd8dc !important;}
    .template-3 header { justify-content: flex-start; background: none; }
    .template-3 .company-logo { margin-left: 0; margin-right: 1rem; max-height: 48px; }
    .template-3 .company-title { margin-right: 1.5rem; font-size: 1.11rem; font-weight: 700; color: #3949ab;}
    .template-3 th { background: #f8faff !important; }
    .template-3 .emp-table th { background: #fff !important; width: 43%; font-size: 1em; }
    .template-3 .emp-table td { background: #fff !important; font-size: 1em; }

    /* Exporting class for font size reduction */
    .exporting {
      font-size: 0.65em !important;
    }
    .exporting header { font-size: 1em !important; }
    .exporting th, .exporting td { font-size: 1em !important; }
  </style>
</head>
<body>
  <header>
    <h1>Payslip Generator</h1>
    <p>Generate, preview, and download payslips in INR with custom items and beautiful templates.</p>
  </header>
  <main>
    <form id="payslipForm" autocomplete="off">
      <div class="row">
        <div class="form-group">
          <label>Employee Name</label>
          <input type="text" id="empName" required>
        </div>
        <div class="form-group">
          <label>Employee ID</label>
          <input type="text" id="empId" required>
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label>Designation</label>
          <input type="text" id="designation">
        </div>
        <div class="form-group">
          <label>Payslip Month</label>
          <input type="month" id="payslipMonth" required>
        </div>
        <div class="form-group">
          <label>LOP Days</label>
          <input type="number" min="0" id="lopDays" required value="0">
        </div>
      </div>
      <div class="form-group">
        <label>Bank Account Number</label>
        <input type="text" id="bankAccount" required>
      </div>
      <div class="form-group">
        <label>Company Name</label>
        <input type="text" id="companyName" required>
      </div>
      <div class="form-group">
        <label>Company Address</label>
        <input type="text" id="companyAddress">
      </div>
      <div class="form-group">
        <label>Company Logo (optional)</label>
        <input type="file" id="companyLogo" accept="image/*">
        <img id="logoPreview" class="logo-preview" style="display:none;">
      </div>
      <div class="row">
        <div class="form-group table-section">
          <label>Earnings&nbsp;
            <button type="button" class="add-row-btn" onclick="addRow('earnings')">+ Add</button>
          </label>
          <table class="custom-table" id="earningsTable">
            <thead><tr><th>Description</th><th>Amount (INR)</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="form-group table-section">
          <label>Deductions&nbsp;
            <button type="button" class="add-row-btn" onclick="addRow('deductions')">+ Add</button>
          </label>
          <table class="custom-table" id="deductionsTable">
            <thead><tr><th>Description</th><th>Amount (INR)</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="form-group template-selector">
        <label>Template</label>
        <select id="template">
          <option value="1">Classic Blue</option>
          <option value="2">Modern Teal</option>
          <option value="3">Classic Blue Right Logo</option>
        </select>
      </div>
      <button type="button" class="btn" id="previewBtn">Preview</button>
      <button type="button" class="btn" id="downloadPDFBtn" disabled>Download PDF</button>
      <button type="button" class="btn" id="downloadImgBtn" disabled>Download Image</button>
    </form>

    <section class="preview-section" id="previewSection" style="display:none;">
      <h2>Payslip Preview</h2>
      <div id="payslipPreview"></div>
    </section>
  </main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  function inr(v) {
    if (!v || isNaN(v)) return "₹0";
    return "₹" + (+v).toLocaleString('en-IN', {maximumFractionDigits:2});
  }
  function addRow(type, desc='', amt='') {
    const tableId = type === 'earnings' ? 'earningsTable' : 'deductionsTable';
    const tbody = document.getElementById(tableId).querySelector('tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" class="desc" value="${desc}" required placeholder="Description"></td>
      <td><input type="number" class="amt" value="${amt}" min="0" required placeholder="Amount"></td>
      <td><button type="button" class="remove-row-btn" title="Remove" onclick="removeRow(this)">&times;</button></td>
    `;
    tbody.appendChild(tr);
    updateNetPay();
  }
  function removeRow(btn) {
    btn.closest('tr').remove();
    updateNetPay();
  }
  document.getElementById("companyLogo").addEventListener("change", function(e) {
    const file = e.target.files[0];
    const logoPreview = document.getElementById("logoPreview");
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        logoPreview.src = e.target.result;
        logoPreview.style.display = "block";
        logoPreview.dataset.logo = e.target.result;
      }
      reader.readAsDataURL(file);
    } else {
      logoPreview.src = "";
      logoPreview.style.display = "none";
      logoPreview.dataset.logo = "";
    }
  });
  function collectRows(type) {
    const tableId = type === 'earnings' ? 'earningsTable' : 'deductionsTable';
    const rows = [];
    document.querySelectorAll(`#${tableId} tbody tr`).forEach(tr => {
      const desc = tr.querySelector('.desc').value.trim();
      const amt = parseFloat(tr.querySelector('.amt').value) || 0;
      if (desc) rows.push({desc, amt});
    });
    return rows;
  }
  function sumRows(rows) {
    return rows.reduce((sum, r) => sum + (parseFloat(r.amt)||0), 0);
  }
  function updateNetPay() {
    const earnings = collectRows('earnings');
    const deductions = collectRows('deductions');
    const net = sumRows(earnings) - sumRows(deductions);
  }

  // Improved payslipHTML: minimal grey, all details left, single column
  function payslipHTML(data, template=1) {
    let templateClass = "template-" + template;
    // single column employee details, all left-aligned
    let empRows = [
      `<div class="emp-row"><span class="label">Employee Name:</span> <span class="emp-value">${data.empName}</span></div>`,
      `<div class="emp-row"><span class="label">Employee ID:</span> <span class="emp-value">${data.empId}</span></div>`,
      `<div class="emp-row"><span class="label">Designation:</span> <span class="emp-value">${data.designation||""}</span></div>`,
      `<div class="emp-row"><span class="label">Payslip Month:</span> <span class="emp-value">${data.payslipMonth}</span></div>`,
      `<div class="emp-row"><span class="label">LOP Days:</span> <span class="emp-value">${data.lopDays}</span></div>`,
      `<div class="emp-row"><span class="label">Bank Account Number:</span> <span class="emp-value">${data.bankAccount}</span></div>`
    ].join("");
    let empTable = `<div class="emp-table">${empRows}</div>`;
    let earningsRows = data.earnings.map(r=>`<tr><td class="label">${r.desc}</td><td>${inr(r.amt)}</td></tr>`).join('');
    let deductionsRows = data.deductions.map(r=>`<tr><td class="label">${r.desc}</td><td>${inr(r.amt)}</td></tr>`).join('');
    let earningsTotal = sumRows(data.earnings);
    let deductionsTotal = sumRows(data.deductions);
    let netpay = earningsTotal - deductionsTotal;
    let earningsTable = `
      <table>
        <tr><th>Earnings</th><th>Amount (INR)</th></tr>
        ${earningsRows}
        <tr class="summary"><td>Total Earnings</td><td>${inr(earningsTotal)}</td></tr>
      </table>
    `;
    let deductionsTable = `
      <table>
        <tr><th>Deductions</th><th>Amount (INR)</th></tr>
        ${deductionsRows}
        <tr class="summary"><td>Total Deductions</td><td>${inr(deductionsTotal)}</td></tr>
      </table>
    `;
    let logoHtml = data.logo ? `<img src="${data.logo}" class="company-logo" alt="Company Logo">` : "";
    let headerHtml;
    if(template==3){
      headerHtml = `${logoHtml}<span class="company-title">${data.companyName}</span>`;
    }else{
      headerHtml = `${logoHtml}<span class="company-title">${data.companyName}</span>`;
    }
    return `
    <div class="payslip-container">
      <div class="payslip ${templateClass}" id="slipToExport">
        <header>
          ${headerHtml}
        </header>
        <div class="company-addr">${data.companyAddress||""}</div>
        <hr>
        ${empTable}
        <hr>
        <div class="row" style="gap:2.2em;align-items: flex-start;justify-content:flex-start;">
          <div style="flex:1">${earningsTable}</div>
          <div style="flex:1">${deductionsTable}</div>
        </div>
        <hr>
        <table>
          <tr class="summary"><th>Net Pay</th><th>${inr(netpay)}</th></tr>
        </table>
      </div>
    </div>
    `;
  }

  document.getElementById("previewBtn").addEventListener("click", function() {
    const form = document.getElementById("payslipForm");
    const logo = document.getElementById("logoPreview").dataset.logo || "";
    const data = {
      empName: form.empName.value,
      empId: form.empId.value,
      designation: form.designation.value,
      payslipMonth: form.payslipMonth.value,
      lopDays: form.lopDays.value,
      bankAccount: form.bankAccount.value,
      companyName: form.companyName.value,
      companyAddress: form.companyAddress.value,
      logo: logo,
      earnings: collectRows('earnings'),
      deductions: collectRows('deductions'),
    };
    const template = form.template.value;
    document.getElementById("payslipPreview").innerHTML = payslipHTML(data, template);
    document.getElementById("previewSection").style.display = "block";
    document.getElementById("downloadPDFBtn").disabled = false;
    document.getElementById("downloadImgBtn").disabled = false;
  });

  function getPayslipExportNode() {
    return document.getElementById("slipToExport");
  }

  function addExportingClass() {
    let slip = getPayslipExportNode();
    if (slip) slip.classList.add('exporting');
  }
  function removeExportingClass() {
    let slip = getPayslipExportNode();
    if (slip) slip.classList.remove('exporting');
  }

  document.getElementById("downloadPDFBtn").addEventListener("click", function() {
    const slip = getPayslipExportNode();
    addExportingClass();
    setTimeout(() => {
      html2canvas(slip, {scale: 1.5}).then(canvas => {
        removeExportingClass();
        const imgData = canvas.toDataURL("image/png");
        const pdf = new window.jspdf.jsPDF({orientation: "portrait", unit: "pt", format: "a4"});
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const ratio = Math.min(pageWidth / canvas.width, (pageHeight-40)/ canvas.height);
        const imgWidth = canvas.width * ratio;
        const imgHeight = canvas.height * ratio;
        pdf.addImage(imgData, "PNG", (pageWidth - imgWidth)/2, 20, imgWidth, imgHeight);
        pdf.save("payslip.pdf");
      });
    }, 200);
  });
  document.getElementById("downloadImgBtn").addEventListener("click", function() {
    const slip = getPayslipExportNode();
    addExportingClass();
    setTimeout(() => {
      html2canvas(slip, {scale: 1.5}).then(canvas => {
        removeExportingClass();
        const link = document.createElement("a");
        link.download = "payslip.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }, 200);
  });
  window.onload = function() {
    addRow('earnings');
    addRow('deductions');
  };
</script>
</body>
</html>
